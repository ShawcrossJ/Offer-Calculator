<!DOCTYPE html>
<html>
<head>
    <title>Investment Calculator</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        .container {
            display: flex;
            justify-content: space-between;
            gap: 40px;
        }
        .left, .right {
            width: 48%;
        }
    </style>
</head>
<body>
    <h1>Break-Even & NPV Calculator (Monthly View)</h1>
    <div class="container">
        <div class="left">
            <form method="POST">
                <label>Number of Units:</label>
                <input type="text" name="units" placeholder="24" required><br><br>

                <label>Monthly Rent per Unit ($):</label>
                <input type="text" name="rent" placeholder="800" required><br><br>

                <label>Offered Price ($):</label>
                <input type="text" name="price" required><br><br>

                <label>Monthly Expenses ($):</label>
                <input type="text" name="expense" required><br><br>

                <label>Discount Rate (Annual %, e.g. 8):</label>
                <input type="text" name="rate" placeholder="10" required><br><br>

                <button type="submit">Calculate</button>
            </form>

            {% if break_even is not none %}
                <h2>Break-Even: {{ break_even }} months</h2>
                <h2>NPV Discounted Break-Even:
                    {% if break_even_month %}
                        Month {{ break_even_month }}
                    {% else %}
                        Not reached in 60 months
                    {% endif %}
                </h2>

                <h3>NPV Table (Monthly):</h3>
                <table border="1">
                    <tr>
                        <th>Month</th>
                        <th>Total Gross Revenue ($)</th>
                        <th>Total Expenses ($)</th>
                        <th>Discounted NPV ($)</th>
                        <th>Nominal NPV ($)</th>
                    </tr>
                    {% for row in npv_table %}
                        <tr>
                            <td>{{ row[0] }}</td>
                            <td>{{ row[3] }}</td>
                            <td>{{ row[4] }}</td>
                            <td>{{ row[1] }}</td>
                            <td>{{ row[2] }}</td>
                        </tr>
                    {% endfor %}
                </table>
            {% endif %}
        </div>

        <div class="right">
            {% if break_even is not none %}
                <h3>NPV (Discounted) Chart:</h3>
                <canvas id="npvChart" width="600" height="400"></canvas>
                <script>
                    const ctx = document.getElementById('npvChart').getContext('2d');
                    const chart = new Chart(ctx, {
                        type: 'line',
                        data: {
                            labels: {{ months | tojson }},
                            datasets: [{
                                label: 'Discounted NPV ($)',
                                data: {{ discounted_npv | tojson }},
                                borderColor: 'blue',
                                fill: false,
                                tension: 0.1
                            }]
                        },
                        options: {
                            scales: {
                                x: { title: { display: true, text: 'Month' } },
                                y: { title: { display: true, text: 'Discounted NPV ($)' } }
                            }
                        }
                    });
                </script>
            {% endif %}
        </div>
    </div>
</body>
</html>
